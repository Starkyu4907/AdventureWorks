version: 2

sources:
  - name: adventure_works
    description: "Tabelas transacionais brutas do banco Adventure Works (fea_academy.adventure_works)."
    database: fea_academy
    schema: adventure_works

    tables:
      # ------------------------
      # SALES
      # ------------------------
      - name: sales_salesorderheader
        description: "Cabeçalho do pedido de venda (1 linha por pedido)."
        columns:
          - name: salesorderid
            description: "Identificador do pedido."
            tests:
              - not_null
              - unique
          - name: orderdate
            description: "Data do pedido."
            tests:
              - not_null
          - name: customerid
            description: "Cliente associado ao pedido."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'sales_customer')
                  field: customerid
          - name: shiptoaddressid
            description: "Endereço de entrega do pedido."
            tests:
              - relationships:
                  to: source('adventure_works', 'person_address')
                  field: addressid
          - name: creditcardid
            description: "Cartão de crédito utilizado no pedido."
            tests:
              - relationships:
                  to: source('adventure_works', 'sales_creditcard')
                  field: creditcardid
          - name: status
            description: "Código de status do pedido."

      - name: sales_salesorderdetail
        description: "Itens do pedido de venda."
        columns:
          - name: salesorderdetailid
            description: "Identificador do item do pedido."
            tests:
              - not_null
              - unique
          - name: salesorderid
            description: "Identificador do pedido."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'sales_salesorderheader')
                  field: salesorderid
          - name: productid
            description: "Produto vendido."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'production_product')
                  field: productid
          - name: orderqty
            description: "Quantidade comprada."
            tests:
              - not_null
          - name: unitprice
            description: "Preço unitário do item."
            tests:
              - not_null
          - name: unitpricediscount
            description: "Desconto percentual aplicado no item."

      - name: sales_customer
        description: "Entidade de cliente utilizada nas vendas; pode representar pessoa (personid) e/ou loja (storeid)."
        columns:
          - name: customerid
            description: "Identificador do cliente."
            tests:
              - not_null
              - unique
          - name: personid
            description: "Identificador da pessoa."
            tests:
              - relationships:
                  to: source('adventure_works', 'person_person')
                  field: businessentityid
          - name: storeid
            description: "Identificador da loja/empresa."
            tests:
              - relationships:
                  to: source('adventure_works', 'sales_store')
                  field: businessentityid

      - name: sales_store
        description: "Cadastro de lojas/empresas."
        columns:
          - name: businessentityid
            description: "Identificador da loja/empresa."
            tests:
              - not_null
              - unique
          - name: name
            description: "Nome da loja/empresa."
            tests:
              - not_null

      - name: sales_creditcard
        description: "Cadastro de cartões de crédito."
        columns:
          - name: creditcardid
            description: "Identificador do cartão."
            tests:
              - not_null
              - unique
          - name: cardtype
            description: "Tipo do cartão."
            tests:
              - not_null

      - name: sales_salesreason
        description: "Cadastro de motivos de venda."
        columns:
          - name: salesreasonid
            description: "Identificador do motivo."
            tests:
              - not_null
              - unique
          - name: name
            description: "Nome do motivo."
            tests:
              - not_null
          - name: reasontype
            description: "Tipo do motivo (ex.: Promotion, Marketing, Other)."

      - name: sales_salesorderheadersalesreason
        description: "Tabela ponte entre pedidos e motivos."
        columns:
          - name: salesorderid
            description: "Identificador do pedido."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'sales_salesorderheader')
                  field: salesorderid
          - name: salesreasonid
            description: "Identificador do motivo."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'sales_salesreason')
                  field: salesreasonid

      # ------------------------
      # PERSON (localização e nomes)
      # ------------------------
      - name: person_person
        description: "Cadastro de pessoas referenciadas por clientes e colaboradores."
        columns:
          - name: businessentityid
            description: "Identificador da pessoa."
            tests:
              - not_null
              - unique
          - name: firstname
            description: "Primeiro nome."
          - name: lastname
            description: "Sobrenome."

      - name: person_address
        description: "Cadastro de endereços."
        columns:
          - name: addressid
            description: "Identificador do endereço."
            tests:
              - not_null
              - unique
          - name: city
            description: "Cidade."
            tests:
              - not_null
          - name: stateprovinceid
            description: "Identificador do estado/província."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'person_stateprovince')
                  field: stateprovinceid

      - name: person_stateprovince
        description: "Cadastro de estados/províncias."
        columns:
          - name: stateprovinceid
            description: "Identificador do estado/província."
            tests:
              - not_null
              - unique
          - name: name
            description: "Nome do estado/província."
            tests:
              - not_null
          - name: countryregioncode
            description: "Código do país/região."
            tests:
              - not_null
              - relationships:
                  to: source('adventure_works', 'person_countryregion')
                  field: countryregioncode

      - name: person_countryregion
        description: "Cadastro de países/regiões."
        columns:
          - name: countryregioncode
            description: "Código do país/região. (Pode vir nulo no dado bruto; regra aplicada no staging)."
            tests:
              - unique
          - name: name
            description: "Nome do país/região."
            tests:
              - not_null

      # ------------------------
      # PRODUCTION
      # ------------------------
      - name: production_product
        description: "Cadastro de produtos."
        columns:
          - name: productid
            description: "Identificador do produto."
            tests:
              - not_null
              - unique
          - name: name
            description: "Nome do produto."
            tests:
              - not_null
          - name: productnumber
            description: "Código do produto."
          - name: color
            description: "Cor do produto."
          - name: listprice
            description: "Preço de lista."

      - name: production_productmodel
        description: "Cadastro de modelos de produto."
        columns:
          - name: productmodelid
            description: "Identificador do modelo."
            tests:
              - not_null
              - unique
          - name: name
            description: "Nome do modelo."
            tests:
              - not_null

models:
  # ------------------------
  # STAGING
  # ------------------------
  - name: stg_person_countryregion
    description: "Staging de países/regiões com padronização de tipos e correção de nulos (Namibia)."
    columns:
      - name: countryregioncode
        description: "Código do país/região (corrigido no staging; Namibia recebe 'NA')."
        tests:
          - unique
      - name: country_name
        description: "Nome do país/região."


  # ------------------------
  # DIMENSIONS
  # ------------------------
  - name: dim_countryregion
    description: "Dimensão de país/região derivada do staging."
    columns:
      - name: countryregion_sk
        description: "Surrogate key da dimensão."

      - name: countryregioncode
        description: "Código do país/região (não-nulo)."

      - name: country_name
        description: "Nome do país/região."
        
